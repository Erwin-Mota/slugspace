generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String             @id @default(dbgenerated("(gen_random_uuid())::text"))
  name                  String?
  email                 String             @unique
  emailVerified         DateTime?          @db.Timestamp(6)
  image                 String?
  createdAt             DateTime?          @default(now()) @db.Timestamp(6)
  updatedAt             DateTime?          @default(now()) @db.Timestamp(6)
  role                  String?            @default("student")
  major                 String?
  year                  String?
  interests             String[]
  college               String?
  accounts              Account[]
  clubMemberships       ClubMember[]
  sessions              Session[]
  studyGroupMemberships StudyGroupMember[]
  userAnalytics         UserAnalytics?

  @@index([email], map: "idx_users_email")
  @@map("users")
}

model Account {
  id                String  @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  sessionToken String   @unique
  userId       String
  expires      DateTime @db.Timestamp(6)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime @db.Timestamp(6)

  @@unique([identifier, token])
  @@map("verificationtokens")
}

model Club {
  id              String         @id @default(dbgenerated("(gen_random_uuid())::text"))
  name            String
  description     String?
  category        String
  meetingTime     String?
  meetingLocation String?
  contactEmail    String?
  website         String?
  instagram       String?
  discord         String?
  imageUrl        String?
  isActive        Boolean?       @default(true)
  createdAt       DateTime?      @default(now()) @db.Timestamp(6)
  updatedAt       DateTime?      @default(now()) @db.Timestamp(6)
  memberCount     Int?           @default(0)
  popularityScore Float?         @default(0.0)
  clubAnalytics   ClubAnalytics?
  members         ClubMember[]

  @@index([category], map: "idx_clubs_category")
  @@index([name], map: "idx_clubs_name")
  @@map("clubs")
}

model ClubMember {
  id       String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId   String
  clubId   String
  role     String?   @default("member")
  joinedAt DateTime? @default(now()) @db.Timestamp(6)
  club     Club      @relation(fields: [clubId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, clubId])
  @@map("club_members")
}

model Course {
  id              String             @id @default(dbgenerated("(gen_random_uuid())::text"))
  code            String             @unique
  name            String
  description     String?
  department      String?
  units           Int?
  prerequisites   String[]
  professor       String?
  schedule        String?
  location        String?
  isActive        Boolean?           @default(true)
  createdAt       DateTime?          @default(now()) @db.Timestamp(6)
  updatedAt       DateTime?          @default(now()) @db.Timestamp(6)
  studentCount    Int?               @default(0)
  activityScore   Float?             @default(0.0)
  courseAnalytics CourseAnalytics?
  studyGroups     StudyGroupMember[]

  @@index([code], map: "idx_courses_code")
  @@index([name], map: "idx_courses_name")
  @@map("courses")
}

model StudyGroupMember {
  id       String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId   String
  courseId String
  role     String?   @default("member")
  joinedAt DateTime? @default(now()) @db.Timestamp(6)
  course   Course    @relation(fields: [courseId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, courseId])
  @@map("study_group_members")
}

model College {
  id              String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  name            String    @unique
  description     String?
  imageUrl        String?
  stereotypes     String[]
  createdAt       DateTime? @default(now()) @db.Timestamp(6)
  updatedAt       DateTime? @default(now()) @db.Timestamp(6)
  popularityScore Float?    @default(0.0)

  @@index([name], map: "idx_colleges_name")
  @@map("colleges")
}

model UserAnalytics {
  id              String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId          String    @unique
  loginCount      Int?      @default(0)
  lastLoginAt     DateTime? @db.Timestamp(6)
  pageViews       Int?      @default(0)
  searchCount     Int?      @default(0)
  clubJoins       Int?      @default(0)
  studyGroupJoins Int?      @default(0)
  createdAt       DateTime? @default(now()) @db.Timestamp(6)
  updatedAt       DateTime? @default(now()) @db.Timestamp(6)
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("user_analytics")
}

model ClubAnalytics {
  id           String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  clubId       String    @unique
  viewCount    Int?      @default(0)
  joinCount    Int?      @default(0)
  searchCount  Int?      @default(0)
  lastViewedAt DateTime? @db.Timestamp(6)
  createdAt    DateTime? @default(now()) @db.Timestamp(6)
  updatedAt    DateTime? @default(now()) @db.Timestamp(6)
  club         Club      @relation(fields: [clubId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("club_analytics")
}

model CourseAnalytics {
  id           String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  courseId     String    @unique
  viewCount    Int?      @default(0)
  joinCount    Int?      @default(0)
  searchCount  Int?      @default(0)
  lastViewedAt DateTime? @db.Timestamp(6)
  createdAt    DateTime? @default(now()) @db.Timestamp(6)
  updatedAt    DateTime? @default(now()) @db.Timestamp(6)
  course       Course    @relation(fields: [courseId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("course_analytics")
}

model SearchAnalytics {
  id           String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  searchTerm   String
  searchType   String
  resultsCount Int
  userId       String?
  createdAt    DateTime? @default(now()) @db.Timestamp(6)

  @@map("search_analytics")
}

model RecommendationAnalytics {
  id                  String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId              String
  recommendationType  String
  recommendationCount Int
  createdAt           DateTime? @default(now()) @db.Timestamp(6)

  @@map("recommendation_analytics")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model campus_clubs {
  id            String         @id
  name          String
  category      String
  description   String?
  contactInfo   String?
  meetingTime   String?
  club_crew     club_crew[]
  club_insights club_insights?

  @@index([category])
  @@index([name])
}

model club_crew {
  id            String        @id
  userId        String
  clubId        String
  role          String        @default("member")
  joinedAt      DateTime      @default(now())
  campus_clubs  campus_clubs  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  ucsc_sluggers ucsc_sluggers @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, clubId])
  @@index([clubId])
  @@index([userId])
}

model club_insights {
  id                  String       @id
  clubId              String       @unique
  viewCount           Int          @default(0)
  joinCount           Int          @default(0)
  searchCount         Int          @default(0)
  recommendationShown Int          @default(0)
  popularityScore     Float        @default(0.0)
  memberDemographics  Json?
  updatedAt           DateTime
  campus_clubs        campus_clubs @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@index([popularityScore])
}

model college_survey_insights {
  id                  String   @id
  responses           Json
  recommendedColleges Json
  matchAccuracy       Float?
  userMajor           String?
  userYear            String?
  createdAt           DateTime @default(now())

  @@index([createdAt])
}

model search_insights {
  id             String   @id
  searchTerm     String
  searchType     String
  resultsCount   Int
  userId         String?
  userMajor      String?
  clickedResults Json?
  createdAt      DateTime @default(now())

  @@index([createdAt])
  @@index([searchTerm])
  @@index([searchType])
}

model study_buddies {
  id            String        @id
  userId        String
  courseId      String
  role          String        @default("student")
  joinedAt      DateTime      @default(now())
  ucsc_courses  ucsc_courses  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  ucsc_sluggers ucsc_sluggers @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([courseId])
  @@index([userId])
}

model study_insights {
  id               String       @id
  courseId         String       @unique
  groupCount       Int          @default(0)
  memberCount      Int          @default(0)
  averageGroupSize Float        @default(0.0)
  activityScore    Float        @default(0.0)
  weeklyJoins      Json?
  popularTimes     Json?
  updatedAt        DateTime
  ucsc_courses     ucsc_courses @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([activityScore])
  @@index([courseId])
}

model ucsc_colleges {
  id             String  @id
  name           String  @unique
  stereotype     String?
  housingQuality String?
  funFact        String?
  vibes          String?
  imageUrl       String?

  @@index([name])
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model ucsc_courses {
  id              String          @id
  code            String
  name            String
  credits         Int?
  level           String?
  description     String?
  prerequisites   String?
  quartersOffered String?
  study_buddies   study_buddies[]
  study_insights  study_insights?

  @@index([code])
  @@index([level])
  @@index([name])
}

model ucsc_sluggers {
  id                String          @id
  email             String          @unique
  name              String?
  image             String?
  ucscId            String?         @unique
  major             String?
  year              String?
  college           String?
  personalityTraits Json?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  club_crew         club_crew[]
  study_buddies     study_buddies[]
  user_insights     user_insights?

  @@index([college])
  @@index([email])
  @@index([major])
  @@index([ucscId])
}

model user_insights {
  id                   String        @id
  userId               String        @unique
  pageViews            Json?
  featureUsage         Json?
  recommendationClicks Json?
  sessionCount         Int           @default(0)
  totalTimeSpent       Int           @default(0)
  lastActiveAt         DateTime      @default(now())
  createdAt            DateTime      @default(now())
  updatedAt            DateTime
  ucsc_sluggers        ucsc_sluggers @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([lastActiveAt])
  @@index([userId])
}
